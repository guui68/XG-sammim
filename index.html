<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>বিলিং ম্যানেজার প্রো</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal { display: none; background: rgba(0,0,0,0.85); }
        .active-modal { display: flex; }
        input[type="checkbox"] { width: 22px; height: 22px; accent-color: #10b981; cursor: pointer; }
        .paid-card { border-left: 5px solid #10b981; background: #064e3b20; }
        .due-card { border-left: 5px solid #f43f5e; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 p-4 font-sans min-h-screen">

    <div class="max-w-xl mx-auto">
        <div class="grid grid-cols-3 gap-2 mb-6">
            <div class="bg-blue-600/20 border border-blue-600 p-3 rounded-2xl text-center">
                <p class="text-[10px] uppercase font-bold text-blue-400">মোট</p>
                <h2 id="totalCount" class="text-xl font-bold">0</h2>
            </div>
            <div class="bg-emerald-600/20 border border-emerald-600 p-3 rounded-2xl text-center">
                <p class="text-[10px] uppercase font-bold text-emerald-400">পেইড</p>
                <h2 id="paidCount" class="text-xl font-bold">0</h2>
            </div>
            <div class="bg-rose-600/20 border border-rose-600 p-3 rounded-2xl text-center">
                <p class="text-[10px] uppercase font-bold text-rose-400">বাকি</p>
                <h2 id="dueCount" class="text-xl font-bold">0</h2>
            </div>
        </div>

        <div class="flex gap-2 mb-6">
            <button onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-500 px-4 py-3 rounded-xl font-bold text-sm flex-1 shadow-lg shadow-blue-900/20 transition-all">+ নতুন ইউজার</button>
            <div class="relative w-2/3">
                <input type="text" id="search" onkeyup="renderData()" placeholder="নাম দিয়ে খুঁজুন..." class="w-full bg-slate-900 border border-slate-700 px-4 py-3 rounded-xl outline-none focus:border-emerald-500 transition-all">
            </div>
        </div>

        <h3 class="text-rose-400 font-bold mb-3 text-sm flex items-center gap-2">
            <span class="w-2 h-2 bg-rose-500 rounded-full animate-pulse"></span> পেমেন্ট বাকি
        </h3>
        <div id="dueList" class="space-y-3 mb-8"></div>

        <hr class="border-slate-800 mb-8">

        <h3 class="text-emerald-400 font-bold mb-3 text-sm flex items-center gap-2">
            <span class="w-2 h-2 bg-emerald-500 rounded-full"></span> পেমেন্ট সাকসেস (পেইড)
        </h3>
        <div id="paidList" class="space-y-3 pb-10"></div>
    </div>

    <div id="userModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 p-6 rounded-3xl w-full max-w-sm shadow-2xl">
            <h3 id="modalTitle" class="text-lg font-bold mb-4 text-blue-400">নতুন ইউজার তথ্য</h3>
            <input type="hidden" id="editId">
            <div class="space-y-4">
                <input type="text" id="userName" placeholder="ইউজারের নাম" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-transparent focus:border-blue-500">
                <input type="number" id="userAmount" placeholder="টাকার পরিমাণ" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-transparent focus:border-blue-500">
                <select id="userMonth" class="w-full p-4 bg-slate-800 rounded-xl outline-none">
                    <option>জানুয়ারি ২০২৬</option><option>ফেব্রুয়ারি ২০২৬</option>
                    <option>মার্চ ২০২৬</option><option>এপ্রিল ২০২৬</option>
                </select>
                <div class="flex gap-2">
                    <button onclick="handleUserSubmit()" id="saveBtn" class="bg-emerald-600 hover:bg-emerald-500 flex-1 p-4 rounded-xl font-bold transition-all">সেভ করুন</button>
                    <button onclick="closeModal()" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-xl font-bold transition-all">বাতিল</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ডাটাবেস (LocalStorage)
        let users = JSON.parse(localStorage.getItem('billingDB_v2')) || [];

        // মোডাল খোলা/বন্ধ
        function openAddModal() {
            document.getElementById('modalTitle').innerText = "নতুন ইউজার যোগ করুন";
            document.getElementById('editId').value = "";
            document.getElementById('userName').value = "";
            document.getElementById('userAmount').value = "";
            document.getElementById('userModal').classList.add('active-modal');
        }

        function closeModal() {
            document.getElementById('userModal').classList.remove('active-modal');
        }

        // ইউজার অ্যাড বা এডিট হ্যান্ডলার
        function handleUserSubmit() {
            const id = document.getElementById('editId').value;
            const name = document.getElementById('userName').value.trim();
            const amount = document.getElementById('userAmount').value.trim();
            const month = document.getElementById('userMonth').value;

            if (!name || !amount) return alert("সব ঘর পূরণ করুন!");

            if (id) {
                // এডিট করা
                users = users.map(u => u.id == id ? { ...u, name, amount, month } : u);
            } else {
                // নতুন অ্যাড করা
                users.unshift({ id: Date.now(), name, amount, month, isPaid: false });
            }

            saveAndRender();
            closeModal();
        }

        // এডিট মোড চালু
        function editUser(id) {
            const user = users.find(u => u.id == id);
            document.getElementById('modalTitle').innerText = "তথ্য পরিবর্তন করুন";
            document.getElementById('editId').value = user.id;
            document.getElementById('userName').value = user.name;
            document.getElementById('userAmount').value = user.amount;
            document.getElementById('userMonth').value = user.month;
            document.getElementById('userModal').classList.add('active-modal');
        }

        function toggleStatus(id) {
            users = users.map(u => u.id === id ? { ...u, isPaid: !u.isPaid } : u);
            saveAndRender();
        }

        function deleteUser(id) {
            if (confirm("আপনি কি নিশ্চিতভাবে এই ইউজারটি মুছে ফেলতে চান?")) {
                users = users.filter(u => u.id !== id);
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('billingDB_v2', JSON.stringify(users));
            renderData();
        }

        function renderData() {
            const dueList = document.getElementById('dueList');
            const paidList = document.getElementById('paidList');
            const searchTxt = document.getElementById('search').value.toLowerCase();
            
            dueList.innerHTML = '';
            paidList.innerHTML = '';

            const filtered = users.filter(u => u.name.toLowerCase().includes(searchTxt));

            filtered.forEach(u => {
                const cardClass = u.isPaid ? 'paid-card' : 'due-card';
                const html = `
                    <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl flex justify-between items-center shadow-lg transition-all ${cardClass}">
                        <div class="flex items-center gap-4">
                            <input type="checkbox" ${u.isPaid ? 'checked' : ''} onclick="toggleStatus(${u.id})">
                            <div>
                                <h4 class="font-bold ${u.isPaid ? 'text-slate-400 line-through' : 'text-slate-100'}">${u.name}</h4>
                                <p class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">${u.amount} TK | ${u.month}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="editUser(${u.id})" class="p-2 bg-slate-800 rounded-lg text-blue-400 hover:bg-blue-600 hover:text-white transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                </svg>
                            </button>
                            <button onclick="deleteUser(${u.id})" class="p-2 bg-slate-800 rounded-lg text-rose-500 hover:bg-rose-600 hover:text-white transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                u.isPaid ? paidList.innerHTML += html : dueList.innerHTML += html;
            });

            // ড্যাশবোর্ড রিপোর্ট আপডেট
            const paidCount = users.filter(u => u.isPaid).length;
            document.getElementById('totalCount').innerText = users.length;
            document.getElementById('paidCount').innerText = paidCount;
            document.getElementById('dueCount').innerText = users.length - paidCount;
        }

        window.onload = renderData;
    </script>
</body>
</html>
