<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal { display: none; background: rgba(0,0,0,0.9); }
        .active-modal { display: flex; }
        .user-card { transition: all 0.3s; user-select: none; -webkit-touch-callout: none; }
        .tab-btn.active { background: #3b82f6; color: white; border-radius: 12px; }
        .status-badge { font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 6px; }
    </style>
</head>
<body class="bg-black text-slate-100 font-sans min-h-screen">

    <div class="max-w-xl mx-auto p-4">
        <div class="grid grid-cols-3 gap-2 py-6 mb-4 border-b border-gray-800 text-center">
            <div><p class="text-[10px] text-gray-500 uppercase">‡¶Æ‡ßã‡¶ü</p><h2 id="totalCount" class="text-2xl font-black">0</h2></div>
            <div><p class="text-[10px] text-emerald-500 uppercase">‡¶™‡ßá‡¶á‡¶°</p><h2 id="paidCount" class="text-2xl font-black text-emerald-500">0</h2></div>
            <div><p class="text-[10px] text-rose-500 uppercase">‡¶¨‡¶æ‡¶ï‡¶ø</p><h2 id="dueCount" class="text-2xl font-black text-rose-500">0</h2></div>
        </div>

        <div class="relative mb-6">
            <input type="text" id="search" onkeyup="renderData()" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." 
                   class="w-full bg-gray-900 border border-gray-800 p-5 rounded-2xl outline-none focus:border-blue-500 text-lg shadow-2xl">
            <div class="absolute right-4 top-5 text-gray-600">üîç</div>
        </div>

        <div class="flex bg-gray-900 p-1 rounded-2xl mb-6 shadow-inner">
            <button onclick="switchTab('all')" id="tab-all" class="tab-btn active flex-1 py-3 font-bold text-xs uppercase">‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</button>
            <button onclick="switchTab('due')" id="tab-due" class="tab-btn flex-1 py-3 font-bold text-xs uppercase text-rose-400">‡¶¨‡¶æ‡¶ï‡¶ø</button>
            <button onclick="switchTab('paid')" id="tab-paid" class="tab-btn flex-1 py-3 font-bold text-xs uppercase text-emerald-400">‡¶™‡ßá‡¶á‡¶°</button>
        </div>

        <div class="flex justify-between items-center mb-4 px-2">
            <p class="text-[10px] text-gray-500 italic">‡¶≤‡¶Ç ‡¶™‡ßç‡¶∞‡ßá‡¶∏ = ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏</p>
            <button onclick="openModal()" class="bg-blue-600 px-4 py-2 rounded-xl font-bold text-sm">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°</button>
        </div>

        <div id="userList" class="space-y-4 pb-24"></div>
    </div>

    <div id="userModal" class="modal fixed inset-0 z-50 items-center justify-center p-6">
        <div class="bg-gray-900 w-full max-w-sm p-6 rounded-3xl border border-gray-800 shadow-2xl">
            <h3 id="modalTitle" class="text-xl font-bold mb-6 text-blue-400">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>
            <input type="hidden" id="editId">
            <div class="space-y-4">
                <input type="text" id="userName" placeholder="‡¶®‡¶æ‡¶Æ" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl outline-none">
                <input type="number" id="userAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-xl outline-none">
                <div class="flex gap-2 pt-4">
                    <button onclick="handleFormSubmit()" class="flex-1 bg-blue-600 p-4 rounded-xl font-bold">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button onclick="closeModal()" class="bg-gray-800 px-6 rounded-xl font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏
        let users = JSON.parse(localStorage.getItem('idBillingDB')) || [];
        let currentTab = 'all';
        let holdTimer;

        // ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø (‡¶Ø‡ßá‡¶Æ‡¶®: ID-170756...)
        function generateId() { return 'ID-' + Math.floor(Math.random() * 9000 + 1000); }

        function openModal(id = null) {
            const modal = document.getElementById('userModal');
            if (id) {
                const user = users.find(u => u.id === id);
                document.getElementById('editId').value = user.id;
                document.getElementById('userName').value = user.name;
                document.getElementById('userAmount').value = user.amount;
                document.getElementById('modalTitle').innerText = "‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
            } else {
                document.getElementById('editId').value = "";
                document.getElementById('userName').value = "";
                document.getElementById('userAmount').value = "";
                document.getElementById('modalTitle').innerText = "‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°";
            }
            modal.classList.add('active-modal');
        }

        function closeModal() { document.getElementById('userModal').classList.remove('active-modal'); }

        function handleFormSubmit() {
            const editId = document.getElementById('editId').value;
            const name = document.getElementById('userName').value.trim();
            const amount = document.getElementById('userAmount').value.trim();
            if (!name || !amount) return;

            if (editId) {
                users = users.map(u => u.id == editId ? { ...u, name, amount } : u);
            } else {
                users.unshift({ 
                    id: Date.now(), 
                    displayId: generateId(), 
                    name, 
                    amount, 
                    isPaid: false 
                });
            }
            saveAndRender();
            closeModal();
        }

        // ‡¶≤‡¶Ç ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï
        function onTouchStart(id) {
            const user = users.find(u => u.id === id);
            if (user.isPaid) return; 
            holdTimer = setTimeout(() => {
                toggleStatus(id);
                alert("‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏‡¶´‡ßÅ‡¶≤‡¶ø ‡¶™‡ßá‡¶á‡¶° ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‚úÖ");
            }, 1000);
        }
        function onTouchEnd() { clearTimeout(holdTimer); }

        function toggleStatus(id) {
            users = users.map(u => u.id === id ? { ...u, isPaid: !u.isPaid } : u);
            saveAndRender();
        }

        function deleteUser(id) {
            if(confirm("‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                users = users.filter(u => u.id !== id);
                saveAndRender();
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            renderData();
        }

        function saveAndRender() {
            localStorage.setItem('idBillingDB', JSON.stringify(users));
            renderData();
        }

        function renderData() {
            const listArea = document.getElementById('userList');
            const searchVal = document.getElementById('search').value.toLowerCase();
            listArea.innerHTML = '';

            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶®‡¶æ‡¶Æ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá)
            let filtered = users.filter(u => 
                u.name.toLowerCase().includes(searchVal) || 
                u.displayId.toLowerCase().includes(searchVal)
            );

            if (currentTab === 'due') filtered = filtered.filter(u => !u.isPaid);
            if (currentTab === 'paid') filtered = filtered.filter(u => u.isPaid);

            filtered.forEach(u => {
                const statusColor = u.isPaid ? 'text-emerald-500 bg-emerald-500/10' : 'text-rose-500 bg-rose-500/10';
                const statusText = u.isPaid ? '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡¶õ‡ßá (PAID)' : '‡¶¶‡¶ø‡¶õ‡ßá ‡¶®‡¶æ (UNPAID)';
                
                listArea.innerHTML += `
                    <div class="user-card bg-gray-900 border border-gray-800 p-5 rounded-[2rem] flex justify-between items-center shadow-lg"
                         onmousedown="onTouchStart(${u.id})" onmouseup="onTouchEnd()" 
                         ontouchstart="onTouchStart(${u.id})" ontouchend="onTouchEnd()">
                        
                        <div class="flex flex-col gap-1">
                            <span class="text-[10px] text-blue-500 font-mono font-bold">${u.displayId}</span>
                            <h4 class="font-bold text-lg ${u.isPaid ? 'text-gray-500 line-through' : 'text-white'}">${u.name}</h4>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-400 font-bold">${u.amount} TK</span>
                                <span class="status-badge ${statusColor}">${statusText}</span>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            ${u.isPaid ? `
                                <button onclick="openModal(${u.id})" class="p-2 bg-blue-900/20 text-blue-400 rounded-full">‚úé</button>
                                <button onclick="toggleStatus(${u.id})" class="p-2 bg-rose-900/20 text-rose-500 rounded-full">‚Ü∫</button>
                            ` : ''}
                            <button onclick="deleteUser(${u.id})" class="p-2 text-gray-700 text-xl">‚úï</button>
                        </div>
                    </div>
                `;
            });

            const paidNum = users.filter(u => u.isPaid).length;
            document.getElementById('totalCount').innerText = users.length;
            document.getElementById('paidCount').innerText = paidNum;
            document.getElementById('dueCount').innerText = users.length - paidNum;
        }

        window.onload = renderData;
    </script>
</body>
</html>
